(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1954],{3998:(e,t,a)=>{"use strict";a.d(t,{$:()=>d,r:()=>l});var s=a(95155),i=a(12115),r=a(32467),o=a(83101),n=a(64269);let l=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-my-gialoro text-my-marscuro-foreground hover:bg-my-gialoro",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-success text-success-foreground hover:bg-success/90",gold:"bg-[hsl(var(--my-gialoro))] text-[hsl(var(--my-marscuro))] hover:bg-[hsl(var(--my-gialoro))]/90 border-2 border-[hsl(var(--background))]"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,t)=>{let{className:a,variant:i,size:o,asChild:d=!1,...c}=e,u=d?r.DX:"button";return(0,s.jsx)(u,{className:(0,n.cn)(l({variant:i,size:o,className:a})),ref:t,...c})});d.displayName="Button"},14585:(e,t,a)=>{"use strict";a.d(t,{IG:()=>c,db:()=>d,j2:()=>l});var s=a(52078),i=a(19708),r=a(58134),o=a(59253);let n=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyAeNVPO7H0mlsM3FXjjZJqpeB5Fi6ITISw",authDomain:"libera-energia-soci.firebaseapp.com",projectId:"libera-energia-soci",storageBucket:"libera-energia-soci.firebasestorage.app",messagingSenderId:"371255545862",appId:"1:371255545862:web:295479b2e6d2dadebaf387",measurementId:"G-4NWSYM1KPW"}),l=(0,o.xI)(n),d=(0,i.getFirestore)(n),c=(0,r.c7)(n)},15894:(e,t,a)=>{"use strict";a.d(t,{dj:()=>u});var s=a(12115);let i=0,r=new Map,o=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},n=[],l={toasts:[]};function d(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,5)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?o(a):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),n.forEach(e=>{e(l)})}function c(e){let{...t}=e,a=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function u(){let[e,t]=s.useState(l);return s.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},18510:(e,t,a)=>{"use strict";a.d(t,{P:()=>c,f:()=>u});var s=a(95155),i=a(12115),r=a(19708),o=a(14585),n=a(15894),l=a(13328);let d=(0,i.createContext)(null);function c(){return(0,i.useContext)(d)}function u(e){let{children:t}=e,[a]=(0,l.hD)(o.j2),[c,u]=(0,i.useState)([]),m=(0,i.useRef)([]),{toast:h}=(0,n.dj)();return(0,i.useEffect)(()=>{if(!a){u([]),m.current=[];return}let e=(0,r.collection)(o.db,"users/".concat(a.uid,"/userAwards")),t=(0,r.onSnapshot)(e,async e=>{let t=await Promise.all(e.docs.map(async e=>{let t=e.data(),a=t.name,s=t.value;if((!a||"number"!=typeof s)&&t.awardId){let e=await (0,r.getDoc)((0,r.doc)(o.db,"awards",t.awardId));e.exists()&&(a=e.data().name,s=e.data().value)}return{id:e.id,awardId:t.awardId,name:a,value:s,residuo:t.residuo,usedValue:t.usedValue,used:t.used,assignedAt:t.assignedAt}}));m.current.length>0&&t.forEach(e=>{let t=m.current.find(t=>t.id===e.id);t&&e.residuo>t.residuo&&h({title:"Bonus riaccreditato",description:"Il tuo bonus di ".concat(e.residuo-t.residuo,"â‚¬ \xe8 stato riaccreditato perch\xe9 il pagamento non \xe8 stato accettato."),variant:"success"})}),m.current=t,u(t)});return()=>t()},[a,h]),(0,s.jsx)(d.Provider,{value:c,children:t})}},25591:(e,t,a)=>{Promise.resolve().then(a.bind(a,86616))},64269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var s=a(2821),i=a(75889);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.QP)((0,s.$)(t))}},86259:(e,t,a)=>{"use strict";a.d(t,{w:()=>n});var s=a(95155),i=a(12115),r=a(57268),o=a(64269);let n=i.forwardRef((e,t)=>{let{className:a,orientation:i="horizontal",decorative:n=!0,...l}=e;return(0,s.jsx)(r.b,{ref:t,decorative:n,orientation:i,className:(0,o.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",a),...l})});n.displayName=r.b.displayName},86616:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B});var s=a(95155),i=a(12115),r=a(18510),o=a(52619),n=a.n(o),l=a(20063),d=a(14585),c=a(19708),u=a(13328),m=a(2546),h=a(93169),f=a(11064),b=a(36867),p=a(94972),g=a(42997),x=a(75004),v=a(50817),y=a(44622),j=a(98428),w=a(92033),S=a(3998),N=a(15894),A=a(64269),k=a(86259),C=a(89511),E=a(83101),I=a(26615);let P=C.bL,T=C.l9,_=C.bm,F=C.ZL,M=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)(C.hJ,{className:(0,A.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...i,ref:t})});M.displayName=C.hJ.displayName;let D=(0,E.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),O=i.forwardRef((e,t)=>{let{side:a="right",className:i,children:r,...o}=e;return(0,s.jsxs)(F,{children:[(0,s.jsx)(M,{}),(0,s.jsxs)(C.UC,{ref:t,className:(0,A.cn)(D({side:a}),i),...o,children:[r,(0,s.jsxs)(C.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,s.jsx)(I.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});O.displayName=C.UC.displayName;let R=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,A.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};R.displayName="SheetHeader";let z=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)(C.hE,{ref:t,className:(0,A.cn)("text-lg font-semibold text-foreground",a),...i})});function L(e){let{href:t,children:a,icon:i,onClick:r}=e,o=(0,l.usePathname)(),d=o.startsWith(t)&&("/dashboard"!==t||"/dashboard"===o);return(0,s.jsx)(_,{asChild:!0,children:(0,s.jsxs)(n(),{href:t,onClick:e=>{r&&r()},className:(0,A.cn)("sidebar-menu-link flex items-center gap-3 rounded-lg px-3 py-2 transition-all",d&&"bg-muted"),children:[(0,s.jsx)(i,{className:"h-4 w-4"}),a]})})}function V(e){let{userData:t,onLinkClick:a}=e;if(!t)return null;let i="active"===t.associationStatus,r=("yes"===t.isFormerMember||"completed"===t.trialStatus)&&"active"!==t.associationStatus&&"pending"!==t.associationStatus;return!0===t.subscriptionPaymentFailed?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L,{href:"/dashboard",icon:m.A,onClick:a,children:"Scheda Personale"}),(0,s.jsx)(L,{href:"/dashboard/payments",icon:h.A,onClick:a,children:"I Miei Pagamenti"}),(0,s.jsx)(L,{href:"/dashboard/subscriptions",icon:h.A,onClick:a,children:"Abbonamenti"}),"admin"===t.role&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.w,{className:"my-2"}),(0,s.jsx)(L,{href:"/admin",icon:f.A,onClick:a,children:"Pannello Admin"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L,{href:"/dashboard",icon:m.A,onClick:a,children:"Scheda Personale"}),(0,s.jsx)(L,{href:"/dashboard/renew-medical-certificate",icon:b.A,onClick:a,children:"Rinnovo Certificato Medico"}),(0,s.jsx)(L,{href:"/dashboard/payments",icon:h.A,onClick:a,children:"I Miei Pagamenti"}),(0,s.jsx)(L,{href:"/dashboard/wallet",icon:p.A,onClick:a,children:"I miei Premi"}),r&&(0,s.jsx)(L,{href:"/dashboard/associates",icon:g.A,onClick:a,children:"Diventa Socio"}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L,{href:"/dashboard/subscriptions",icon:h.A,onClick:a,children:"Abbonamenti"}),(0,s.jsx)(L,{href:"/dashboard/attendances",icon:x.A,onClick:a,children:"Le Mie Presenze"}),(0,s.jsx)(L,{href:"/dashboard/calendar",icon:v.A,onClick:a,children:"Stages, Esami e Corsi"})]}),"admin"===t.role&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.w,{className:"my-2"}),(0,s.jsx)(L,{href:"/admin",icon:f.A,onClick:a,children:"Pannello Admin"})]})]})}function W(e){let{onLogout:t,userData:a,showMenu:r}=e,[o,l]=(0,i.useState)(!1);return(0,s.jsxs)("header",{className:"sticky top-0 z-30 flex h-20 items-center gap-4 border-b bg-dark-brown text-title-yellow px-4 sm:px-6 justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-4",children:r&&(0,s.jsxs)(P,{open:o,onOpenChange:l,children:[(0,s.jsx)(T,{asChild:!0,children:(0,s.jsx)(S.$,{variant:"outline",className:"border-title-yellow text-title-yellow hover:bg-white/20 hover:text-title-yellow",children:(0,s.jsx)(y.A,{className:"h-5 w-5"})})}),(0,s.jsxs)(O,{side:"left",className:"p-0",children:[(0,s.jsx)(R,{children:(0,s.jsx)(z,{children:"Menu"})}),(0,s.jsxs)("nav",{className:"flex flex-col gap-1 p-4",children:[(0,s.jsx)(_,{asChild:!0,children:(0,s.jsx)(n(),{href:"/dashboard",className:"group flex h-10 w-10 shrink-0 items-center justify-center gap-2 rounded-full text-lg font-semibold text-primary-foreground md:text-base",children:(0,s.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/libera-energia-soci.firebasestorage.app/o/grafimg%2Ftigre-PP.png?alt=media&token=8cf5490d-1498-4a13-b827-f2e9fe0b94ba",alt:"Tigre",className:"w-12 h-12 object-contain"})})}),(0,s.jsx)(V,{userData:a,onLinkClick:()=>l(!1)})]})]})]})}),(0,s.jsxs)("div",{className:"flex-1 flex justify-center items-center gap-3",children:[(0,s.jsx)("span",{className:"text-lg font-bold",style:{color:"hsl(var(--foreground))"},children:"Libera Energia"}),(0,s.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/libera-energia-soci.firebasestorage.app/o/grafimg%2Ftigre-M.png?alt=media&token=b5f3540f-ab42-46ed-9722-9c4e9663a97b",alt:"Logo Libera Energia",className:"w-auto object-contain",style:{height:"60px"}}),(0,s.jsx)("span",{className:"text-lg font-bold",style:{color:"hsl(var(--foreground))"},children:"Arti Marziali"})]}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsxs)(S.$,{variant:"outline",onClick:t,className:"border-title-yellow text-title-yellow hover:bg-white/20 hover:text-title-yellow",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-2"}),(0,s.jsx)("span",{className:"uppercase font-bold",children:"Log out"})]})})]})}function B(e){let{children:t}=e,[a,o]=(0,u.hD)(d.j2),[n,m]=(0,i.useState)(null),[h,f]=(0,i.useState)(!0),{toast:b}=(0,N.dj)(),p=(0,l.useRouter)(),g=(0,l.usePathname)(),x=(0,i.useCallback)(async()=>{try{await d.j2.signOut(),p.push("/"),b({title:"Logout effettuato",description:"Sei stato disconnesso con successo."})}catch(e){console.error("Error during logout:",e),b({variant:"destructive",title:"Errore di logout",description:"Impossibile disconnettersi. Riprova."})}},[p,b]);if((0,i.useEffect)(()=>{let e=async()=>{if(!a)return void(0,l.redirect)("/");f(!0);try{let n,l,u=(0,c.doc)(d.db,"users",a.uid),h=await (0,c.getDoc)(u),v=h.exists()?h.data():null,y=[];if(h.exists()){var e,t,s,i,r,o;let u=(0,c.doc)(d.db,"users/".concat(a.uid,"/trialLessons/main")),h=await (0,c.getDoc)(u);if(h.exists()){let e=h.data();n=e.trialStatus,l=e.trialExpiryDate,y=Array.isArray(e.lessons)?e.lessons:[]}if(m({...v,name:null!=(e=null==v?void 0:v.name)?e:"",email:null!=(t=null==v?void 0:v.email)?t:"",regulationsAccepted:null!=(s=null==v?void 0:v.regulationsAccepted)&&s,applicationSubmitted:null!=(i=null==v?void 0:v.applicationSubmitted)&&i,medicalCertificateSubmitted:null!=(r=null==v?void 0:v.medicalCertificateSubmitted)&&r,isFormerMember:null!=(o=null==v?void 0:v.isFormerMember)?o:"no",trialStatus:n,trialExpiryDate:l,trialLessons:y}),["/dashboard/regulations","/dashboard/medical-certificate","/dashboard/liberasphere","/dashboard/class-selection","/dashboard/associates","/dashboard/trial-completed","/dashboard/reviews"].includes(g))return void f(!1);if((null==v?void 0:v.subscriptionPaymentFailed)===!0){let e=(null==v?void 0:v.role)==="admin"&&g.startsWith("/admin");if(!["/dashboard","/dashboard/payments","/dashboard/subscriptions","/dashboard/subscriptions/monthly","/dashboard/subscriptions/seasonal"].includes(g)&&!e){p.push("/dashboard/subscriptions"),f(!1);return}}if("completed"===n&&(null==v?void 0:v.associationStatus)==="not_associated"){"/dashboard/trial-completed"!==g&&p.push("/dashboard/trial-completed"),f(!1);return}if((null==v?void 0:v.trialPaymentFailed)===!0||(null==v?void 0:v.associationStatus)==="pending"||(null==v?void 0:v.associationStatus)==="active"||(null==v?void 0:v.associationStatus)==="expired"||"pending_payment"===n||"active"===n||(null==v?void 0:v.role)==="admin"||(null==v?void 0:v.associationPaymentFailed)===!0||(null==v?void 0:v.medicalCertificateStatus)==="invalid")return void f(!1);let b="";(null==v?void 0:v.regulationsAccepted)?(null==v?void 0:v.medicalCertificateSubmitted)?(null==v?void 0:v.isFormerMember)?(null==v?void 0:v.isFormerMember)==="yes"?b="/dashboard/associates":(null==v?void 0:v.isFormerMember)==="no"&&"pending_payment"!==n&&"active"!==n&&(b="/dashboard/class-selection"):b="/dashboard/liberasphere":b="/dashboard/medical-certificate":b="/dashboard/regulations",b&&g!==b&&p.push(b)}else b({variant:"destructive",title:"Errore Critico",description:"Profilo utente non trovato. Eseguo il logout."}),await x()}catch(e){console.error("Errore nel caricamento dati:",e),b({title:"Errore di Caricamento",description:"Impossibile caricare i dati. Riprova.",variant:"destructive"})}finally{f(!1)}};!o&&a?e():o||a||(0,l.redirect)("/")},[a,o,g,p,b]),o||h)return(0,s.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-background",children:(0,s.jsx)(w.A,{className:"h-16 w-16 animate-spin text-primary"})});if(!a||!n)return null;let v=["/dashboard/regulations","/dashboard/medical-certificate","/dashboard/liberasphere","/dashboard/trial-completed","/dashboard/class-selection","/dashboard/associates"].includes(g)&&"pending"!==n.associationStatus&&"pending_payment"!==n.trialStatus;return(0,s.jsx)(r.f,{children:(0,s.jsxs)("div",{className:"flex min-h-screen w-full flex-col bg-background",children:[(0,s.jsx)(W,{onLogout:x,userData:n,showMenu:!v}),(0,s.jsx)("main",{className:"flex-1 p-4 md:p-8",children:t})]})})}z.displayName=C.hE.displayName,i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)(C.VY,{ref:t,className:(0,A.cn)("text-sm text-muted-foreground",a),...i})}).displayName=C.VY.displayName}},e=>{e.O(0,[2992,7138,4909,3947,3328,1930,531,2619,4944,8441,1255,7358],()=>e(e.s=25591)),_N_E=e.O()}]);