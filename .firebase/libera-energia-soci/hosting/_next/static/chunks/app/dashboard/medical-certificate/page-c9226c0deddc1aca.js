(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5835],{30014:(e,i,t)=>{Promise.resolve().then(t.bind(t,65798))},65798:(e,i,t)=>{"use strict";t.r(i),t.d(i,{default:()=>P});var a=t(95155),l=t(12115),r=t(20063),s=t(22544),c=t(66942),o=t(98734),n=t(14585),d=t(59253),u=t(13328),p=t(19708),f=t(58134),m=t(52619),h=t.n(m),x=t(3998),v=t(86948),j=t(41052),y=t(65142),g=t(76444),N=t(15894),b=t(92033),D=t(18527),w=t(97776),C=t(36654),S=t(98428),F=t(89106),I=t(19056);let k=o.Ik({certificateFile:o.Nl(File).optional(),expiryDate:o.Yj({required_error:"La data di scadenza \xe8 obbligatoria."})});function P(){let[e,i]=(0,u.hD)(n.j2),t=(0,r.useRouter)(),{toast:o}=(0,N.dj)(),[m,P]=(0,l.useState)(!0),[M,z]=(0,l.useState)(!1),[A,E]=(0,l.useState)(null),[_,G]=(0,l.useState)(null),L=(0,s.mN)({resolver:(0,c.u)(k),defaultValues:{certificateFile:void 0,expiryDate:""}}),R=(0,l.useCallback)(async e=>{let i=(0,p.doc)(n.db,"users",e),t=await (0,p.getDoc)(i);if(t.exists()){let e=t.data();if(e.medicalInfo){var a;let i={type:e.medicalInfo.type,fileUrl:e.medicalInfo.fileUrl,fileName:e.medicalInfo.fileName,expiryDate:null==(a=e.medicalInfo.expiryDate)?void 0:a.toDate()};G(i),L.reset({expiryDate:(e=>{if(!e)return;let i=e instanceof p.Timestamp?e.toDate():e;return(0,F.GP)(i,"yyyy-MM-dd")})(i.expiryDate)||""}),i.fileName&&E(i.fileName)}}},[L]);(0,l.useEffect)(()=>{e?(P(!0),R(e.uid).finally(()=>P(!1))):i||P(!1)},[e,i,R]);let T=e=>{var i;let t=null==(i=e.target.files)?void 0:i[0];if(t){if(!["application/pdf","image/jpeg","image/png"].includes(t.type)){o({variant:"destructive",title:"Tipo di file non valido",description:"Puoi caricare solo file PDF, JPG o PNG."}),e.target.value="";return}L.setValue("certificateFile",t,{shouldValidate:!0}),E(t.name)}},U=async i=>{if(!e)return void o({variant:"destructive",title:"Errore",description:"Utente non autenticato."});if(!i.certificateFile&&!(null==_?void 0:_.fileUrl))return void o({variant:"destructive",title:"File Mancante",description:"Per favore, carica il file del certificato."});z(!0);try{let a=(0,p.doc)(n.db,"users",e.uid),l={..._,type:"certificate",updatedAt:(0,p.serverTimestamp)()};if(i.expiryDate){if(i.certificateFile){let t=(0,F.GP)(new Date,"yyyy-MM-dd'T'HH-mm-ss"),a="certificato_medico_".concat(t,".").concat(i.certificateFile.name.split(".").pop()),r=(0,f.KR)(n.IG,"medical-certificates/".concat(e.uid,"/").concat(a)),s=await (0,f.D)(r,i.certificateFile);l.fileUrl=await (0,f.qk)(s.ref),l.fileName=a}l.expiryDate=p.Timestamp.fromDate((0,I.H)(i.expiryDate))}let r={medicalCertificateSubmitted:!0,medicalInfo:l,updatedAt:(0,p.serverTimestamp)()};await (0,p.updateDoc)(a,r),o({title:"Dati inviati con successo!",description:"Le tue informazioni mediche sono state aggiornate."}),t.push("/dashboard/liberasphere")}catch(e){console.error("Errore durante l'invio dei dati medici:",e),o({variant:"destructive",title:"Errore",description:"Impossibile salvare i dati. Riprova."})}finally{z(!1)}},V=async()=>{z(!0);try{await (0,d.CI)(n.j2),t.push("/"),o({title:"Logout effettuato",description:"Sei stato disconnesso con successo."})}catch(e){console.error("Error during logout:",e),o({variant:"destructive",title:"Errore di logout",description:"Impossibile disconnettersi. Riprova."})}finally{z(!1)}};return m?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(b.A,{className:"h-16 w-16 animate-spin text-primary"})}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsxs)(v.Zp,{className:"w-full max-w-2xl",children:[(0,a.jsxs)(v.aR,{children:[(0,a.jsx)(v.ZB,{children:"Certificato Medico"}),(0,a.jsx)(v.BT,{children:(0,a.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,a.jsx)("p",{children:"La certificazione medica per la pratica dell’attivit\xe0 sportiva non agonistica \xe8 regolato dal Decreto Ministeriale del 24 aprile 2013 e integrato dalle Linee-Guida emanate dal Ministro della Salute con Decreto dell’8 agosto 2014, nonch\xe9 dalle successive circolari ministeriali (Nota Esplicativa del 17 giugno 2015 e nota integrativa del 28 ottobre 2015)."}),(0,a.jsx)("p",{children:"Sono soggetti al certificato non agonistico tutti gli associati ad una ASD e tesserati presso un ente, che svolgano attivit\xe0. La certificazione \xe8 rilasciata dal proprio medico di medicina generale o pediatra o dal medico specialista in medicina dello sport, Il certificato ha validit\xe0 annuale dalla data di rilascio. Pu\xf2 essere sostituito da un certificato agonistico, di qualsiasi sport, come da Circolare del Ministero della Salute del 01/02/2018. Senza il certificato medico viene a mancare la copertura assicurativa."}),(0,a.jsx)("p",{className:"medical-upload-text",children:"Sono accettati i certificati medici in corso di validit\xe0 rilasciati per qualsiasi attivit\xe0 sportiva, e quelli rilasciati per attivit\xe0 parascolastiche."})]})})]}),(0,a.jsx)(j.lV,{...L,children:(0,a.jsxs)("form",{onSubmit:L.handleSubmit(U),children:[(0,a.jsx)(v.Wu,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"space-y-4 rounded-md border-2 p-4 animate-in fade-in-50",style:{borderColor:"hsl(22.5, 55%, 11%)"},children:[(0,a.jsx)("h4",{className:"medical-upload-text font-bold text-center",children:"Carica o aggiorna il tuo certificato"}),(0,a.jsx)(j.zB,{control:L.control,name:"certificateFile",render:e=>{let{field:i}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"File del certificato (PDF, JPG, PNG)"}),(0,a.jsx)(j.MJ,{children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y.p,{id:"certificate-file-input",type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:T}),(0,a.jsx)(g.J,{htmlFor:"certificate-file-input",className:"flex items-center justify-center w-full h-24 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",style:{borderColor:"#16a34a"},children:A?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,a.jsx)(D.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:A})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(w.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Clicca per scegliere un nuovo file"})]})})]})}),(0,a.jsx)(j.C5,{})]})}}),(null==_?void 0:_.fileUrl)&&(0,a.jsx)(x.$,{variant:"outline",asChild:!0,className:"w-full",children:(0,a.jsxs)(h(),{href:_.fileUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,a.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Visualizza Certificato Caricato"]})}),(0,a.jsx)(j.zB,{control:L.control,name:"expiryDate",render:e=>{let{field:i}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Data di scadenza del certificato"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(y.p,{type:"date",...i})}),(0,a.jsx)(j.C5,{})]})}})]})}),(0,a.jsxs)(v.wL,{className:"flex-col items-stretch space-y-4",children:[(0,a.jsxs)(x.$,{type:"submit",className:"w-full font-bold",style:{backgroundColor:"#16a34a",color:"hsl(22.5, 55%, 11%)"},disabled:M||!L.formState.isValid,children:[M&&(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Salva e prosegui"]}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-center text-sm text-muted-foreground pt-2",children:[(0,a.jsx)("p",{children:"Non hai il certificato a portata di mano?"}),(0,a.jsx)("p",{children:"Puoi uscire e tornare pi\xf9 tardi. I tuoi dati sono salvi."})]}),(0,a.jsxs)(x.$,{type:"button",variant:"outline",onClick:V,disabled:M,className:"font-bold",style:{backgroundColor:"hsl(0, 1%, 77%)",borderColor:"hsl(22.5, 55%, 11%)",color:"hsl(22.5, 55%, 11%)"},children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"}),"Esci e completa pi\xf9 tardi"]})]})]})]})})]})})}},98428:(e,i,t)=>{"use strict";t.d(i,{A:()=>a});let a=(0,t(14294).A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])}},e=>{e.O(0,[2992,7138,4909,3947,7134,3328,9106,1821,2619,9335,8441,1255,7358],()=>e(e.s=30014)),_N_E=e.O()}]);