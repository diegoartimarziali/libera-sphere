(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{3998:(e,t,a)=>{"use strict";a.d(t,{$:()=>c,r:()=>o});var s=a(95155),i=a(12115),r=a(32467),n=a(83101),l=a(64269);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-my-gialoro text-my-marscuro-foreground hover:bg-my-gialoro",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-success text-success-foreground hover:bg-success/90",gold:"bg-[hsl(var(--my-gialoro))] text-[hsl(var(--my-marscuro))] hover:bg-[hsl(var(--my-gialoro))]/90 border-2 border-[hsl(var(--background))]"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=i.forwardRef((e,t)=>{let{className:a,variant:i,size:n,asChild:c=!1,...d}=e,u=c?r.DX:"button";return(0,s.jsx)(u,{className:(0,l.cn)(o({variant:i,size:n,className:a})),ref:t,...d})});c.displayName="Button"},14585:(e,t,a)=>{"use strict";a.d(t,{IG:()=>d,db:()=>c,j2:()=>o});var s=a(52078),i=a(19708),r=a(58134),n=a(59253);let l=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyAeNVPO7H0mlsM3FXjjZJqpeB5Fi6ITISw",authDomain:"libera-energia-soci.firebaseapp.com",projectId:"libera-energia-soci",storageBucket:"libera-energia-soci.firebasestorage.app",messagingSenderId:"371255545862",appId:"1:371255545862:web:295479b2e6d2dadebaf387",measurementId:"G-4NWSYM1KPW"}),o=(0,n.xI)(l),c=(0,i.getFirestore)(l),d=(0,r.c7)(l)},15894:(e,t,a)=>{"use strict";a.d(t,{dj:()=>u});var s=a(12115);let i=0,r=new Map,n=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},l=[],o={toasts:[]};function c(e){o=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,5)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(o,e),l.forEach(e=>{e(o)})}function d(e){let{...t}=e,a=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function u(){let[e,t]=s.useState(o);return s.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},18332:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>o,TN:()=>d,XL:()=>c});var s=a(95155),i=a(12115),r=a(83101),n=a(64269);let l=(0,r.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",warning:"border-yellow-500/50 text-yellow-700 bg-yellow-50 dark:bg-yellow-950 dark:text-yellow-400 [&>svg]:text-yellow-500 dark:[&>svg]:text-yellow-400",info:"border-blue-500/50 text-blue-700 bg-blue-50 dark:bg-blue-950 dark:text-blue-400 [&>svg]:text-blue-500 dark:[&>svg]:text-blue-400",success:"border-green-500/50 text-green-700 bg-green-50 dark:bg-green-950 dark:text-green-400 [&>svg]:text-green-500 dark:[&>svg]:text-green-400"}},defaultVariants:{variant:"default"}}),o=i.forwardRef((e,t)=>{let{className:a,variant:i,...r}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(l({variant:i}),a),...r})});o.displayName="Alert";let c=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...i})});c.displayName="AlertTitle";let d=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...i})});d.displayName="AlertDescription"},18510:(e,t,a)=>{"use strict";a.d(t,{P:()=>d,f:()=>u});var s=a(95155),i=a(12115),r=a(19708),n=a(14585),l=a(15894),o=a(13328);let c=(0,i.createContext)(null);function d(){return(0,i.useContext)(c)}function u(e){let{children:t}=e,[a]=(0,o.hD)(n.j2),[d,u]=(0,i.useState)([]),m=(0,i.useRef)([]),{toast:x}=(0,l.dj)();return(0,i.useEffect)(()=>{if(!a){u([]),m.current=[];return}let e=(0,r.collection)(n.db,"users/".concat(a.uid,"/userAwards")),t=(0,r.onSnapshot)(e,async e=>{let t=await Promise.all(e.docs.map(async e=>{let t=e.data(),a=t.name,s=t.value;if((!a||"number"!=typeof s)&&t.awardId){let e=await (0,r.getDoc)((0,r.doc)(n.db,"awards",t.awardId));e.exists()&&(a=e.data().name,s=e.data().value)}return{id:e.id,awardId:t.awardId,name:a,value:s,residuo:t.residuo,usedValue:t.usedValue,used:t.used,assignedAt:t.assignedAt}}));m.current.length>0&&t.forEach(e=>{let t=m.current.find(t=>t.id===e.id);t&&e.residuo>t.residuo&&x({title:"Bonus riaccreditato",description:"Il tuo bonus di ".concat(e.residuo-t.residuo,"€ \xe8 stato riaccreditato perch\xe9 il pagamento non \xe8 stato accettato."),variant:"success"})}),m.current=t,u(t)});return()=>t()},[a,x]),(0,s.jsx)(c.Provider,{value:d,children:t})}},27685:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ee});var s=a(95155),i=a(12115),r=a(15894),n=a(14585),l=a(13328),o=a(19708),c=a(89106),d=a(47691),u=a(48109),m=a(55428),x=a(84668),p=a(20063),f=a(18332),g=a(86948),h=a(3998),v=a(64269);function b(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,v.cn)("animate-pulse rounded-md bg-muted",t),...a})}var j=a(78770),N=a(47974),y=a(18527),A=a(71051),S=a(19884),w=a(62593),D=a(17199),T=a(60406),z=a(86259),C=a(49595),I=a(89679),k=a(27314),P=a(94417),E=a(10639),M=a(6943),L=a(18274),F=a(7710),R=a(5225),_=a(36867),O=a(19201),G=a(11064),X=a(56397),B=a(91851),V=a(36304),H=a(34517);let q=e=>{let{icon:t,label:a,value:i,valueClassName:r}=e;if(null==i||""===i||"Nessuna"===i)return null;let n="email"===a.toLowerCase(),l=(0,v.cn)("ml-auto text-muted-foreground text-right",{"font-bold":n},r);return(0,s.jsxs)("div",{className:"flex items-center text-sm",children:[(0,s.jsx)("div",{className:"w-5 text-muted-foreground",children:t}),(0,s.jsxs)("span",{className:"ml-3 font-bold",children:[a,":"]}),(0,s.jsx)("span",{className:l,children:"boolean"==typeof i?i?"S\xec":"No":i})]})};function $(e){let t=e.regulationsAccepted&&e.regulationsAcceptedAt?"".concat(e.regulationsStatus," il ").concat((0,c.GP)(e.regulationsAcceptedAt,"dd/MM/yyyy",{locale:x.it})):e.regulationsStatus,a=e.regulationsAccepted?"text-green-600 font-bold":"",i=(0,v.cn)("font-bold",{"text-green-600":"valid"===e.medicalStatusState,"text-orange-500":"expiring"===e.medicalStatusState,"text-destructive":"expired"===e.medicalStatusState}),r=(0,v.cn)("font-bold",{"text-green-600":e.isInsured,"text-destructive":!e.isInsured}),n=(0,v.cn)("font-bold",{"text-orange-500":"pending_payment"===e.trialStatusState,"text-green-600":"active"===e.trialStatusState,"text-muted-foreground":"completed"===e.trialStatusState}),l=(0,v.cn)("font-bold",{"text-orange-500":"pending"===e.membershipStatusState,"text-green-600":"active"===e.membershipStatusState,"text-destructive":"expired"===e.membershipStatusState}),o=(0,v.cn)("font-bold",{"text-orange-500":"In attesa di approvazione"===e.subscriptionStatus||"In scadenza"===e.subscriptionStatus,"text-green-600":"Attivo"===e.subscriptionStatus,"text-destructive":"Scaduto"===e.subscriptionStatus||"Non Approvato"===e.subscriptionStatus}),d=(0,v.cn)("font-bold",{"text-muted-foreground":!e.socioDal||"N/A"===e.socioDal})+(e.socioDal&&/^\d{4}$/.test(e.socioDal)?" !text-[hsl(var(--background))]":"");return(0,s.jsxs)(g.Zp,{className:"flex flex-col",children:[(0,s.jsxs)(g.aR,{className:"flex flex-col items-center text-center p-4",children:[(0,s.jsx)(g.ZB,{className:"text-2xl",children:e.name}),(0,s.jsx)("div",{className:"text-lg font-bold pt-1",children:e.sportingSeason}),(0,s.jsxs)("div",{className:"text-base pt-1",children:[(0,s.jsx)("span",{children:"Disciplina:"})," ",(0,s.jsx)("span",{className:"font-bold",children:e.discipline}),e.grade&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"ml-2",children:"Grado:"})," ",(0,s.jsx)("span",{className:"font-bold",children:e.grade})]})]}),(0,s.jsx)("div",{className:"text-base pt-1",children:e.qualifica&&"Nessuna"!==e.qualifica&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"Qualifica:"})," ",(0,s.jsx)("span",{className:"font-bold",children:e.qualifica})]})}),(0,s.jsxs)("div",{className:"text-base pt-1",children:[(0,s.jsx)("span",{children:"Palestra:"})," ",(0,s.jsx)("span",{className:"font-bold",children:e.gymName})]})]}),(0,s.jsxs)(g.Wu,{className:"flex-grow space-y-4 p-4",children:[(0,s.jsxs)("div",{className:"space-y-3 bg-gray-100 p-4 rounded-md",style:{borderColor:"hsl(var(--background))",borderWidth:"2px"},children:[(0,s.jsxs)("h4",{className:"text-lg font-bold flex items-center justify-center text-center",style:{color:"hsl(var(--background))"},children:[(0,s.jsx)(C.A,{size:16,className:"mr-3 w-5",style:{color:"hsl(var(--background))"}}),"Dati Anagrafici"]}),(0,s.jsxs)("div",{className:"pl-8 space-y-3",children:[(0,s.jsx)(q,{icon:(0,s.jsx)(N.A,{size:16}),label:"Email",value:e.email}),(0,s.jsx)(q,{icon:(0,s.jsx)(I.A,{size:16}),label:"Telefono",value:e.phone,valueClassName:"font-bold"}),(0,s.jsx)(q,{icon:(0,s.jsx)(k.A,{size:16}),label:"Codice Fiscale",value:e.taxCode,valueClassName:"font-bold"}),(0,s.jsx)(q,{icon:(0,s.jsx)(P.A,{size:16}),label:"Nato/a il",value:e.birthDate?"".concat((0,c.GP)(e.birthDate,"dd/MM/yyyy",{locale:x.it})," a ").concat(e.birthPlace):void 0,valueClassName:"font-bold"}),(0,s.jsx)(q,{icon:(0,s.jsx)(E.A,{size:16}),label:"Indirizzo",value:e.fullAddress,valueClassName:"font-bold"})]})]}),e.isMinor&&e.parentData&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("h4",{className:"text-sm font-bold flex items-center",children:[(0,s.jsx)(M.A,{size:16,className:"mr-3 w-5 text-muted-foreground"}),"Dati Genitore/Tutore"]}),(0,s.jsxs)("div",{className:"pl-8 space-y-3",children:[(0,s.jsx)(q,{icon:(0,s.jsx)(k.A,{size:16}),label:"Nome",value:"".concat(e.parentData.parentName," ").concat(e.parentData.parentSurname)}),(0,s.jsx)(q,{icon:(0,s.jsx)(k.A,{size:16}),label:"Codice Fiscale",value:e.parentData.parentTaxCode})]})]}),(0,s.jsx)(z.w,{}),(0,s.jsxs)("div",{className:"p-6 rounded-lg bg-gray-50 border-2 space-y-3",style:{borderColor:"hsl(var(--background))"},children:[(0,s.jsxs)("h4",{className:"text-lg font-bold flex items-center justify-center text-center",style:{color:"hsl(var(--background))"},children:[(0,s.jsx)(L.A,{size:16,className:"mr-3 w-5",style:{color:"hsl(var(--background))"}}),"Stato Associativo, Medico e Assicurativo"]}),(0,s.jsxs)("div",{className:"pl-8 space-y-3",children:[(0,s.jsx)(q,{icon:(0,s.jsx)(F.A,{size:16}),label:"Socio Dal",value:e.socioDal,valueClassName:d}),(0,s.jsx)(q,{icon:(0,s.jsx)(R.A,{size:16}),label:"Statuto e Regolamenti",value:t,valueClassName:a}),(0,s.jsx)(q,{icon:(0,s.jsx)(_.A,{size:16}),label:"Certificato Medico",value:e.medicalStatus,valueClassName:i}),(0,s.jsx)(q,{icon:(0,s.jsx)(O.A,{size:16}),label:"Assicurato",value:e.isInsured,valueClassName:r}),(0,s.jsx)(q,{icon:(0,s.jsx)(G.A,{size:16}),label:"Stato Associazione",value:e.membershipStatus,valueClassName:l})]})]}),(0,s.jsx)(z.w,{}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("h4",{className:"text-lg font-bold flex items-center justify-center text-center",style:{color:"hsl(30, 100%, 38%)"},children:[(0,s.jsx)(X.A,{size:16,className:"mr-3 w-5 text-muted-foreground"}),"Abbonamenti e Prove"]}),(0,s.jsxs)("div",{className:"pl-8 space-y-3",children:[(0,s.jsx)(q,{icon:(0,s.jsx)(B.A,{size:16}),label:"Stato Prova",value:e.trialStatus,valueClassName:n}),(0,s.jsx)(q,{icon:(0,s.jsx)(V.A,{size:16}),label:"Abbonamento mese di",value:e.subscriptionValidity,valueClassName:"font-bold text-muted-foreground"}),(0,s.jsx)(q,{icon:(0,s.jsx)(X.A,{size:16}),label:"Stato Abbonamento",value:e.subscriptionStatus,valueClassName:o})]})]}),e.trialLessons&&e.trialLessons.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.w,{}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("h4",{className:"text-sm font-bold flex items-center justify-center text-center",children:[(0,s.jsx)(H.A,{size:16,className:"mr-3 w-5 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-blue-900",children:"Lezioni di Prova Prenotate"})]}),e.trialLessons.map((e,t)=>{let a=(0,c.GP)(e.date,"EEEE dd/MM",{locale:x.it}),i=a.split(" ")[0],r=a.substring(i.length).trim();return(0,s.jsxs)("div",{className:"flex flex-col items-center text-sm",children:[(0,s.jsxs)("span",{className:"font-bold text-blue-900",children:[t+1,"\xaa Lezione:"]}),(0,s.jsxs)("span",{className:"font-medium text-blue-900 capitalize",children:[i," ",r," - ",e.time]})]},t)})]})]})]})]})}var W=a(39179),Z=a(18510);function Y(){let e=(0,Z.P)(),t=Array.isArray(e)?e.reduce((e,t)=>e+(t.value||0),0):0,a=null;if(Array.isArray(e)&&e.length>0){let t=[...e].filter(e=>e.assignedAt).sort((e,t)=>new Date(e.assignedAt).getTime()-new Date(t.assignedAt).getTime());if(t.length>0){let e,s=t[0].assignedAt;isNaN((e=s&&"object"==typeof s&&"function"==typeof s.toDate?s.toDate():new Date(s)).getTime())||(a=e.toLocaleDateString("it-IT"))}}return(0,s.jsx)(g.Zp,{className:"mb-6 border-green-600",style:{borderWidth:"3px"},children:(0,s.jsxs)(g.Wu,{className:"flex flex-col items-center justify-center py-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 w-full mb-2",children:[(0,s.jsx)(W.A,{className:"h-6 w-6 text-green-700"}),(0,s.jsxs)("span",{className:"font-bold text-green-700 text-sm",children:["Premi Assegnati",a?" dal ".concat(a):""]}),(0,s.jsxs)("span",{className:"font-bold text-green-700 text-2xl",children:[t,"€"]})]}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground text-center leading-tight",children:"Valore totale di tutti i premi assegnati (inclusi quelli gi\xe0 usati)"})]})})}var K=a(92033),Q=a(86678),U=a(748);function J(){let[e,t]=(0,i.useState)(!0),[a,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(null),[p,g]=(0,i.useState)(null),v=p?"attendance-toast-".concat(p.id):null,b=v?localStorage.getItem(v):null,[j,N]=(0,i.useState)(!1),[y,A]=(0,i.useState)(!1),[S]=(0,l.hD)(n.j2),{toast:w}=(0,r.dj)();(0,i.useEffect)(()=>{(async()=>{if(!S)return t(!1);try{let e=new Date;e.setHours(0,0,0,0);let a=new Date;a.setHours(23,59,59,999);let s=(0,o.query)((0,o.collection)(n.db,"attendances"),(0,o.where)("userId","==",S.uid),(0,o.where)("lessonDate",">=",o.Timestamp.fromDate(e)),(0,o.where)("lessonDate","<=",o.Timestamp.fromDate(a)));if(!(await (0,o.getDocs)(s)).empty){N(!0),t(!1);return}let i=(0,o.doc)(n.db,"users",S.uid),r=await (0,o.getDoc)(i);if(!r.exists())return void t(!1);let l=r.data();if("active"!==l.associationStatus||"active"!==l.subscriptionAccessStatus)return void t(!1);if(m(l),l.gym&&l.discipline){let t=(0,o.query)((0,o.collection)(n.db,"events"),(0,o.where)("type","==","lesson"),(0,o.where)("gymId","==",l.gym),(0,o.where)("discipline","==",l.discipline),(0,o.where)("startTime",">=",o.Timestamp.fromDate(e)),(0,o.where)("startTime","<=",o.Timestamp.fromDate(a)),(0,o.orderBy)("startTime"),(0,o.limit)(1)),s=await (0,o.getDocs)(t);if(!s.empty){let e=s.docs[0];g({id:e.id,...e.data()})}}}catch(e){console.error("Error checking for attendance prompt:",e),w({variant:"destructive",title:"Errore",description:"Impossibile verificare le lezioni di oggi."})}finally{t(!1)}})()},[S,w]),(0,i.useEffect)(()=>{},[!1,u,p]),(0,i.useEffect)(()=>{if(!p)return;if(j||b)return void A(!1);let e=p.startTime.toDate(),t=new Date,a=e.getTime()-108e5,s=e.getTime()+36e5,i=t.getTime();if(i>=a&&i<=s)A(!0);else{if(i>s)return void D("assente",!0);A(!1);let e=a-i;if(e>0){let t=setTimeout(()=>{A(!0)},e),a=setTimeout(()=>{j||D("assente",!0)},s-i);return()=>{clearTimeout(t),clearTimeout(a)}}}},[p,j,b]);let D=async function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],S&&u&&p){d(!0);try{let t=new Date;t.setHours(0,0,0,0);let a=(0,o.writeBatch)(n.db),s=(0,o.doc)((0,o.collection)(n.db,"users",S.uid,"attendances"));if(a.set(s,{userId:S.uid,userName:u.name,userSurname:u.surname,gymId:p.gymId,gymName:p.gymName,discipline:p.discipline,lessonDate:o.Timestamp.fromDate(t),status:e,recordedAt:(0,o.serverTimestamp)(),eventId:p.id}),"presente"===e){let e=(0,o.doc)(n.db,"users",S.uid);a.update(e,{progress:{presences:(0,o.increment)(1)}})}await a.commit(),N(!0),A(!1),localStorage.setItem("attendance-toast-".concat(p.id),"true"),w({title:"Risposta Registrata!",description:"Grazie per averci fatto sapere."})}catch(e){console.error("Error recording attendance:",e),w({variant:"destructive",title:"Errore",description:"Impossibile registrare la tua risposta."})}finally{d(!1)}}};return e?(0,s.jsx)("div",{className:"h-24 flex items-center justify-center",children:(0,s.jsx)(K.A,{className:"h-6 w-6 animate-spin"})}):y&&p&&!j&&!b?(0,s.jsxs)(f.Fc,{className:"mb-6 animate-in fade-in-50 border-[4px] !border-green-600 bg-green-50",style:{borderWidth:4,borderColor:"#16a34a"},children:[(0,s.jsx)(Q.A,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)(f.XL,{className:"font-bold",children:"Appello per la lezione di oggi, ogni presenza ti premia!"}),(0,s.jsxs)(f.TN,{children:["Sei dei nostri stasera per la lezione di ",null==u?void 0:u.discipline," delle ",(0,c.GP)(p.startTime.toDate(),"HH:mm",{locale:x.it}),"?"]}),(0,s.jsxs)("div",{className:"mt-4 flex gap-4",children:[(0,s.jsx)(h.$,{className:"w-full font-bold",variant:"success",onClick:()=>D("presente",!0),disabled:a,children:a?(0,s.jsx)(K.A,{className:"animate-spin"}):(0,s.jsx)("span",{className:"font-bold",children:"Presente"})}),(0,s.jsx)(h.$,{className:"w-full font-bold",variant:"destructive",onClick:()=>{D("assente",!0)},disabled:a,children:a?(0,s.jsx)(K.A,{className:"animate-spin"}):(0,s.jsx)("span",{className:"font-bold",children:"Assente"})})]})]}):!p||j||b?null:"festivita"===p.status?(0,s.jsxs)(f.Fc,{variant:"info",className:"mb-6 animate-in fade-in-50",children:[(0,s.jsx)(U.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Nessuna Lezione Oggi"}),(0,s.jsx)(f.TN,{children:"Oggi la palestra \xe8 chiusa per festivit\xe0. Goditi il riposo!"})]}):(0,s.jsxs)(f.Fc,{className:"mb-6 animate-in fade-in-50 bg-green-50",children:[(0,s.jsx)(Q.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{className:"font-bold",children:"Appello per la lezione di oggi, ogni presenza ti premia!"}),(0,s.jsxs)(f.TN,{children:["Sei dei nostri stasera per la lezione di ",null==u?void 0:u.discipline," delle ",(0,c.GP)(p.startTime.toDate(),"HH:mm",{locale:x.it}),"?"]}),(0,s.jsxs)("div",{className:"mt-4 flex gap-4",children:[(0,s.jsx)(h.$,{className:"w-full font-bold",variant:"destructive",onClick:()=>D("assente"),disabled:a,children:a?(0,s.jsx)(K.A,{className:"animate-spin"}):(0,s.jsx)("span",{className:"font-bold",children:"Assente"})}),(0,s.jsx)(h.$,{className:"w-full font-bold",variant:"success",onClick:()=>D("presente"),disabled:a,children:a?(0,s.jsx)(K.A,{className:"animate-spin"}):(0,s.jsx)("span",{className:"font-bold",children:"Presente"})})]})]})}function ee(){var e;let{toast:t}=(0,r.dj)(),[a,v]=(0,l.hD)(n.j2),z=(0,p.useRouter)(),[C,I]=(0,i.useState)(null),[k,P]=(0,i.useState)(!0),[E,M]=(0,i.useState)(null),[L,F]=(0,i.useState)(null),[R,_]=(0,i.useState)(null),[O,G]=(0,i.useState)(!1),[X,B]=(0,i.useState)(!1);(0,i.useEffect)(()=>{!async function(){if(!a)return;let e=(0,o.doc)(n.db,"users/".concat(a.uid,"/trialLessons/main")),t=await (0,o.getDoc)(e);if(!t.exists())return;let s=t.data(),i=Array.isArray(s.lessons)?s.lessons:[];if(0===i.length)return;let r=i.reduce((e,t)=>e.endTime&&t.endTime?e.endTime.toMillis()>t.endTime.toMillis()?e:t:e);if(!r.endTime)return;let l=new Date,c=new Date(r.endTime.toDate());c.setHours(20,30,0,0),l>c&&"completed"!==s.trialStatus&&await (0,o.updateDoc)(e,{trialStatus:"completed"})}();let e=sessionStorage.getItem("showDataCorrectionMessage");!localStorage.getItem("showDataCorrectionMessageExpired")&&e&&(new Date().getTime()-new Date(e).getTime()<36e5?t({title:"Controlla i tuoi dati",description:"Se hai notato errori, invia entro 1 ora una email di correzione a: segreteria@artimarzialivalledaosta.com.",variant:"default"}):(sessionStorage.removeItem("showDataCorrectionMessage"),localStorage.setItem("showDataCorrectionMessageExpired","true"))),sessionStorage.getItem("showSubscriptionActivatedMessage")&&(B(!0),sessionStorage.removeItem("showSubscriptionActivatedMessage")),v||(a?(async()=>{try{let r=(0,o.doc)(n.db,"users",a.uid),l=(0,o.doc)(n.db,"settings","season"),p=(0,o.collection)(n.db,"gyms"),f=(0,o.doc)(n.db,"users/".concat(a.uid,"/payments/status")),[g,h,v,b,j]=await Promise.all([(0,o.getDoc)(r),(0,o.getDoc)(l),(0,o.getDocs)(p),(0,o.getDoc)(f),(0,o.getDoc)((0,o.doc)(n.db,"users/".concat(a.uid,"/trialLessons/main")))]),N=new Map;if(v.forEach(e=>N.set(e.id,e.data().name)),g.exists()){var e,t,s,i;let r,l,p,f,v,y=g.data(),A=y.trialStatus,S=y.trialExpiryDate,w=[];if(j.exists()){let e=j.data();A=e.trialStatus,S=e.trialExpiryDate,w=Array.isArray(e.lessons)?e.lessons:[]}let D=y.subscriptionAccessStatus;if(b.exists())if(l=b.data().status,"completed"===l){if(D="active","pending_payment"===A){let e=(0,o.doc)(n.db,"users/".concat(a.uid,"/trialLessons/main"));await (0,o.updateDoc)(e,{trialStatus:"active"});let t=await (0,o.getDoc)(e);if(t.exists()){let e=t.data();A=e.trialStatus,S=e.trialExpiryDate,w=Array.isArray(e.lessons)?e.lessons:[]}}}else"pending"===l?D="pending":"expired"===l&&(D="expired");I({...y,trialStatus:A,trialExpiryDate:S,trialLessons:w,subscriptionAccessStatus:D});let T="Non Associato";switch(y.associationStatus){case"pending":T="In Attesa di Approvazione";break;case"active":T=y.associationExpiryDate?"Valida fino al ".concat((0,c.GP)(y.associationExpiryDate.toDate(),"dd/MM/yyyy")):"Attiva";break;case"expired":T="Scaduta";break;default:T="Non Associato"}let z="Non Presente",C=null;if((null==(e=y.medicalInfo)?void 0:e.type)==="certificate"&&y.medicalInfo.expiryDate){let e=y.medicalInfo.expiryDate.toDate();z="Scade il ".concat((0,c.GP)(e,"dd/MM/yyyy"));let t=(0,d.o)(new Date),a=(0,d.o)(e),s=(0,u.c)(a,t);C=s<0?"expired":s<=30?"expiring":"valid",M(C),F(s)}let k=y.regulationsAccepted?"Accettati":"Non Accettati",P=("active"===A||"pending_payment"===A)&&w.length>0?w.map(e=>({date:e.startTime.toDate(),time:(0,c.GP)(e.startTime.toDate(),"HH:mm")})):void 0;if(("active"===y.associationStatus||"pending"===y.associationStatus)&&(r="yes"===y.isFormerMember&&y.firstYear?y.firstYear:(0,c.GP)(y.createdAt.toDate(),"yyyy")),"pending_payment"===A&&w.length>0?p="In attesa di approvazione pagamento":"active"===A?p="Attiva":"completed"===A?p="Completata":w.length>0&&(p="Lezioni di prova prenotate"),y.subscriptionPaymentFailed)f="Non Approvato";else if(D&&y.activeSubscription&&"monthly"===y.activeSubscription.type){switch(D){case"pending":f="In attesa di approvazione";break;case"expired":f="Scaduto";break;case"active":if(y.activeSubscription.expiresAt){let e=(0,d.o)(y.activeSubscription.expiresAt.toDate()),t=(0,d.o)(new Date),a=(0,u.c)(e,t);f=(0,m.R)(e)?"Scaduto":a<=4?"In scadenza":"Attivo"}else f="Attivo"}y.activeSubscription.expiresAt&&(v=(0,c.GP)(y.activeSubscription.expiresAt.toDate(),"MMMM yyyy",{locale:x.it}))}else if(D&&y.activeSubscription)switch(D){case"pending":f="In attesa di approvazione";break;case"expired":f="Scaduto";break;case"active":f="Attivo"}_({name:"".concat(y.name," ").concat(y.surname),email:y.email,socioDal:r,sportingSeason:(null==(t=h.data())?void 0:t.label)||"N/D",regulationsStatus:k,regulationsAccepted:y.regulationsAccepted,regulationsAcceptedAt:null==(s=y.regulationsAcceptedAt)?void 0:s.toDate(),medicalStatus:z,medicalStatusState:C,gymName:y.gym?"".concat(y.gym,", ").concat(N.get(y.gym)):void 0,discipline:y.discipline,grade:y.lastGrade,qualifica:y.qualification,membershipStatus:T,membershipStatusState:y.associationStatus,isInsured:y.isInsured,trialLessons:P,trialStatus:p,trialStatusState:A,subscriptionType:null==(i=y.activeSubscription)?void 0:i.name,subscriptionStatus:f,subscriptionValidity:v,taxCode:y.taxCode,phone:y.phone,birthDate:y.birthDate instanceof o.Timestamp?y.birthDate.toDate():void 0,birthPlace:y.birthPlace,fullAddress:y.address?"".concat(y.address,", ").concat(y.streetNumber,", ").concat(y.zipCode," ").concat(y.city," (").concat(y.province,")"):void 0,isMinor:y.isMinor,parentData:y.parentData})}}catch(e){console.error("Error fetching user data for dashboard:",e)}finally{P(!1)}})():P(!1))},[a,v]);let V=async()=>{if(!a)return;let e=(0,o.doc)(n.db,"users",a.uid);await (0,o.updateDoc)(e,{medicalCertificateStatus:null}),z.push("/dashboard/renew-medical-certificate")};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center",children:k?(0,s.jsx)(b,{className:"h-8 w-56 mx-auto"}):"Benvenuto, ".concat((null==C||null==(e=C.name)?void 0:e.split(" ")[0])||"","!")}),(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{children:(0,s.jsx)(b,{className:"h-24 w-full mb-6"})}),children:(0,s.jsx)(J,{})}),k?(0,s.jsx)(b,{className:"h-24 w-full mb-6"}):(()=>{let e=[];return(null==C?void 0:C.associationPaymentFailed)&&e.push((0,s.jsxs)(f.Fc,{variant:"destructive",className:"mb-6",children:[(0,s.jsx)(j.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Domanda di Associazione Rifiutata"}),(0,s.jsx)(f.TN,{children:"La tua domanda non \xe8 stata approvata in quanto l'importo non \xe8 stato trasferito sul nostro conto corrente. Verifica ed effettua un nuovo pagamento."}),(0,s.jsx)(h.$,{onClick:()=>z.push("/dashboard/associates?step=2"),variant:"secondary",className:"mt-4",children:"Procedi al Pagamento"})]},"assoc-failed")),(null==C?void 0:C.trialPaymentFailed)&&e.push((0,s.jsxs)(f.Fc,{variant:"destructive",className:"mb-6",children:[(0,s.jsx)(j.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Pagamento Lezioni di Prova Fallito"}),(0,s.jsx)(f.TN,{children:"La tua iscrizione alle lezioni di prova non \xe8 andata a buon fine. Per favore, ripeti la procedura di iscrizione."}),(0,s.jsx)(h.$,{onClick:()=>z.push("/dashboard/class-selection"),variant:"secondary",className:"mt-4",children:"Iscriviti alle Lezioni"})]},"trial-failed")),(null==C?void 0:C.subscriptionPaymentFailed)&&e.push((0,s.jsxs)("div",{className:"mb-6 w-full max-w-lg p-4 rounded-lg border-2 font-semibold text-base text-center",style:{background:"#FFEAEA",color:"#B91C1C",borderColor:"#B91C1C",margin:"0 auto"},children:[(0,s.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-2"}),(0,s.jsx)("span",{className:"text-xl font-bold",children:"Pagamento Abbonamento Fallito"})]}),(0,s.jsx)("div",{className:"mb-2",children:"La tua richiesta di abbonamento non \xe8 andata a buon fine. Per favore, procedi a un nuovo acquisto."}),(0,s.jsx)(h.$,{onClick:()=>z.push("/dashboard/subscriptions"),variant:"secondary",style:{color:"#B91C1C",borderColor:"#B91C1C",background:"#fff"},className:"mt-2 font-bold",children:"Vai agli Abbonamenti"})]},"sub-failed")),(null==C?void 0:C.medicalCertificateStatus)==="invalid"&&e.push((0,s.jsxs)(f.Fc,{variant:"destructive",className:"mb-6",children:[(0,s.jsx)(j.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Certificato Medico non Valido"}),(0,s.jsx)(f.TN,{children:"Il certificato che hai caricato \xe8 stato respinto. Caricane uno nuovo per ripristinare la tua copertura assicurativa e l'accesso completo alle attivit\xe0."}),(0,s.jsx)(h.$,{onClick:V,variant:"secondary",className:"mt-4",children:"Aggiorna Certificato"})]},"cert-invalid")),O&&!localStorage.getItem("showDataCorrectionMessageExpired")&&e.push((0,s.jsxs)(f.Fc,{variant:"warning",className:"mb-6",children:[(0,s.jsx)(N.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Controlla i tuoi dati"}),(0,s.jsxs)(f.TN,{children:["Se hai notato errori, invia entro 1 ora una email di correzione a: ",(0,s.jsx)("a",{href:"mailto:segreteria@artimarzialivalledaosta.com",className:"font-semibold underline",children:"segreteria@artimarzialivalledaosta.com"}),"."]})]},"data-correction")),X&&(null==C?void 0:C.activeSubscription)&&e.push((0,s.jsxs)(f.Fc,{variant:"success",className:"mb-6",children:[(0,s.jsx)(y.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Abbonamento Attivato!"}),(0,s.jsxs)(f.TN,{children:['Il tuo abbonamento "',C.activeSubscription.name,'" \xe8 attivo!']})]},"sub-activated")),(null==C?void 0:C.associationStatus)==="active"&&"active"!==C.subscriptionAccessStatus&&"pending"!==C.subscriptionAccessStatus&&e.push((0,s.jsxs)(f.Fc,{variant:"success",className:"mb-6",children:[(0,s.jsx)(A.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Associazione Approvata!"}),(0,s.jsx)(f.TN,{children:"La tua Associazione \xe8 stata Approvata. Ora puoi procedere alla scelta del tuo Abbonamento dal menu: Abbonamenti."})]},"sub-choice")),(null==C?void 0:C.subscriptionAccessStatus)==="pending"&&e.push((0,s.jsxs)(f.Fc,{variant:"warning",className:"mb-6",children:[(0,s.jsx)(S.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Abbonamento in Attesa"}),(0,s.jsx)(f.TN,{children:"Il tuo accesso ai corsi sar\xe0 attivato non appena il pagamento del tuo abbonamento verr\xe0 confermato dalla segreteria."})]},"sub-pending")),(null==C?void 0:C.associationStatus)==="pending"&&e.push((0,s.jsxs)(f.Fc,{variant:"warning",className:"mb-6 bg-orange-100 border-orange-500 text-orange-700",children:[(0,s.jsx)(w.A,{className:"h-4 w-4 text-orange-600"}),(0,s.jsx)(f.XL,{className:"text-orange-800",children:"Domanda di Associazione Inviata!"}),(0,s.jsx)(f.TN,{className:"text-orange-700",children:"La tua richiesta \xe8 in attesa di approvazione. Riceverai una notifica non appena il pagamento sar\xe0 confermato e lo stato aggiornato."})]},"assoc-pending")),(null==C?void 0:C.trialStatus)==="pending_payment"&&e.push((0,s.jsxs)(f.Fc,{variant:"warning",className:"mb-6",children:[(0,s.jsx)(w.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Richiesta Lezioni di Prova Inviata!"}),(0,s.jsx)(f.TN,{children:"La tua iscrizione \xe8 in attesa di approvazione. Riceverai una notifica non appena il pagamento sar\xe0 confermato."})]},"trial-pending")),(null==C?void 0:C.trialOutcome)==="declined"&&e.push((0,s.jsxs)(f.Fc,{variant:"info",className:"mb-6",children:[(0,s.jsx)(D.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Ci dispiace vederti andare"}),(0,s.jsx)(f.TN,{children:"Grazie per aver provato i nostri corsi. Le nostre porte per te sono sempre aperte se dovessi cambiare idea in futuro!"})]},"trial-declined")),"expired"===E&&e.push((0,s.jsxs)(f.Fc,{variant:"destructive",className:"mb-6",children:[(0,s.jsx)(j.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Certificato Medico Scaduto!"}),(0,s.jsx)(f.TN,{children:"Il tuo certificato medico \xe8 scaduto. Per continuare le attivit\xe0, devi caricarne uno nuovo."})]},"cert-expired")),"expiring"===E&&null!==L&&e.push((0,s.jsxs)(f.Fc,{variant:"warning",className:"mb-6",children:[(0,s.jsx)(T.A,{className:"h-4 w-4"}),(0,s.jsx)(f.XL,{children:"Certificato Medico in Scadenza"}),(0,s.jsxs)(f.TN,{children:[L>0?"Attenzione, il tuo certificato medico scadr\xe0 tra ".concat(L," giorni."):"Attenzione, il tuo certificato medico scade oggi."," Ricordati di rinnovarlo e caricare la nuova versione."]})]},"cert-expiring")),e.length>0?(0,s.jsx)(s.Fragment,{children:e}):null})(),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-full max-w-2xl",children:(0,s.jsx)(Y,{})}),(0,s.jsx)("div",{className:"w-full max-w-2xl mt-2",children:k||!R?(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{className:"flex flex-col items-center p-4 text-center",children:(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)(b,{className:"h-8 w-48 mx-auto"}),(0,s.jsx)(b,{className:"h-4 w-64 mx-auto"})]})}),(0,s.jsxs)(g.Wu,{className:"space-y-4 p-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(b,{className:"h-5 w-full"}),(0,s.jsx)(b,{className:"h-5 w-full"}),(0,s.jsx)(b,{className:"h-5 w-full"}),(0,s.jsx)(b,{className:"h-5 w-full"})]}),(0,s.jsx)(b,{className:"h-px w-full"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(b,{className:"h-5 w-full"}),(0,s.jsx)(b,{className:"h-5 w-full"}),(0,s.jsx)(b,{className:"h-5 w-full"}),(0,s.jsx)(b,{className:"h-5 w-full"}),(0,s.jsx)(b,{className:"h-5 w-full"})]})]})]}):(0,s.jsx)($,{...R})})]})]})}},64269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var s=a(2821),i=a(75889);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.QP)((0,s.$)(t))}},78842:(e,t,a)=>{Promise.resolve().then(a.bind(a,27685))},86259:(e,t,a)=>{"use strict";a.d(t,{w:()=>l});var s=a(95155),i=a(12115),r=a(57268),n=a(64269);let l=i.forwardRef((e,t)=>{let{className:a,orientation:i="horizontal",decorative:l=!0,...o}=e;return(0,s.jsx)(r.b,{ref:t,decorative:l,orientation:i,className:(0,n.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",a),...o})});l.displayName=r.b.displayName},86948:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>l,wL:()=>u});var s=a(95155),i=a(12115),r=a(64269);let n=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...i})});n.displayName="Card";let l=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...i})});l.displayName="CardHeader";let o=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...i})});o.displayName="CardTitle";let c=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...i})});c.displayName="CardDescription";let d=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",a),...i})});d.displayName="CardContent";let u=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",a),...i})});u.displayName="CardFooter"}},e=>{e.O(0,[2992,7138,4909,3947,7134,3328,9106,2465,8441,1255,7358],()=>e(e.s=78842)),_N_E=e.O()}]);