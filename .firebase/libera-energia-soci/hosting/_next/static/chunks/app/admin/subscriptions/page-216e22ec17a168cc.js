(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7855],{11647:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var r=a(95155);a(12115);var i=a(83101),n=a(64269);let s=(0,i.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-success text-success-foreground hover:bg-success/80",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-500/80"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...i}=e;return(0,r.jsx)("div",{className:(0,n.cn)(s({variant:a}),t),...i})}},19056:(e,t,a)=>{"use strict";a.d(t,{H:()=>i});var r=a(77565);function i(e,t){var a;let i,p,h=null!=(a=null==t?void 0:t.additionalDigits)?a:2,x=function(e){let t,a={},r=e.split(n.dateTimeDelimiter);if(r.length>2)return a;if(/:/.test(r[0])?t=r[0]:(a.date=r[0],t=r[1],n.timeZoneDelimiter.test(a.date)&&(a.date=e.split(n.timeZoneDelimiter)[0],t=e.substr(a.date.length,e.length))),t){let e=n.timezone.exec(t);e?(a.time=t.replace(e[1],""),a.timezone=e[1]):a.time=t}return a}(e);if(x.date){let e=function(e,t){let a=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(a);if(!r)return{year:NaN,restDateString:""};let i=r[1]?parseInt(r[1]):null,n=r[2]?parseInt(r[2]):null;return{year:null===n?i:100*n,restDateString:e.slice((r[1]||r[2]).length)}}(x.date,h);i=function(e,t){var a,r,i,n,l,d,c;if(null===t)return new Date(NaN);let p=e.match(s);if(!p)return new Date(NaN);let h=!!p[4],x=o(p[1]),j=o(p[2])-1,v=o(p[3]),y=o(p[4]),D=o(p[5])-1;if(h){return(a=y,r=D,a>=1&&a<=53&&r>=0&&r<=6)?function(e,t,a){let r=new Date(0);r.setUTCFullYear(e,0,4);let i=r.getUTCDay()||7;return r.setUTCDate(r.getUTCDate()+((t-1)*7+a+1-i)),r}(t,y,D):new Date(NaN)}{let e=new Date(0);return(i=t,n=j,l=v,n>=0&&n<=11&&l>=1&&l<=(u[n]||(m(i)?29:28))&&(d=t,(c=x)>=1&&c<=(m(d)?366:365)))?(e.setUTCFullYear(t,j,Math.max(x,v)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);let j=i.getTime(),v=0;if(x.time&&isNaN(v=function(e){var t,a,i;let n=e.match(l);if(!n)return NaN;let s=c(n[1]),d=c(n[2]),o=c(n[3]);return(t=s,a=d,i=o,24===t?0===a&&0===i:i>=0&&i<60&&a>=0&&a<60&&t>=0&&t<25)?s*r.s0+d*r.Cg+1e3*o:NaN}(x.time)))return new Date(NaN);if(x.timezone){if(isNaN(p=function(e){var t;if("Z"===e)return 0;let a=e.match(d);if(!a)return 0;let i="+"===a[1]?-1:1,n=parseInt(a[2]),s=a[3]&&parseInt(a[3])||0;return(t=s)>=0&&t<=59?i*(n*r.s0+s*r.Cg):NaN}(x.timezone)))return new Date(NaN)}else{let e=new Date(j+v),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}return new Date(j+v+p)}let n={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},s=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,l=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,d=/^([+-])(\d{2})(?::?(\d{2}))?$/;function o(e){return e?parseInt(e):1}function c(e){return e&&parseFloat(e.replace(",","."))||0}let u=[31,null,31,30,31,30,31,31,30,31,30,31];function m(e){return e%400==0||e%4==0&&e%100!=0}},22452:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},26615:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},53756:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var r=a(95155),i=a(12115),n=a(14585),s=a(19708),l=a(15894),d=a(66942),o=a(22544),c=a(98734),u=a(89106),m=a(19056),p=a(86948),h=a(3998),x=a(22452),j=a(92033);let v=(0,a(14294).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var y=a(13630),D=a(65142),g=a(51834),b=a(98053),f=a(41052),N=a(11186),S=a(87270),E=a(11647);let A=e=>{if(!e)return;let t=e instanceof s.Timestamp?e.toDate():e;return(0,u.GP)(t,"yyyy-MM-dd")},C=c.Ik({id:c.Yj().optional(),type:c.k5(["monthly","seasonal"],{required_error:"La tipologia \xe8 obbligatoria."}),name:c.Yj().min(3,"Il nome \xe8 obbligatorio (es. Abbonamento Ottobre)."),totalPrice:c.vk(e=>Number(String(e).replace(",",".")),c.ai().min(0,"Il prezzo non pu\xf2 essere negativo.")),sumupLink:c.Yj().url("Deve essere un URL SumUp valido.").optional().or(c.eu("")),purchaseStartDate:c.Yj().optional(),purchaseEndDate:c.Yj().optional(),validityStartDate:c.Yj({required_error:"La data di inizio validit\xe0 \xe8 obbligatoria."}),validityEndDate:c.Yj({required_error:"La data di fine validit\xe0 \xe8 obbligatoria."}),expiryWarningDate:c.Yj({required_error:"La data per l'avviso di scadenza \xe8 obbligatoria."})}).refine(e=>!e.purchaseStartDate||!e.purchaseEndDate||(0,m.H)(e.purchaseEndDate)>=(0,m.H)(e.purchaseStartDate),{message:"La data di fine acquisto non pu\xf2 precedere quella di inizio.",path:["purchaseEndDate"]}).refine(e=>(0,m.H)(e.validityEndDate)>=(0,m.H)(e.validityStartDate),{message:"La data di fine validit\xe0 non pu\xf2 precedere quella di inizio.",path:["validityEndDate"]}).refine(e=>(0,m.H)(e.expiryWarningDate)<=(0,m.H)(e.validityEndDate)&&(0,m.H)(e.expiryWarningDate)>=(0,m.H)(e.validityStartDate),{message:"La data di avviso deve essere compresa nel periodo di validit\xe0.",path:["expiryWarningDate"]});function w(){var e;let{toast:t}=(0,l.dj)(),[a,c]=(0,i.useState)(!0),[w,z]=(0,i.useState)(!1),[M,k]=(0,i.useState)([]),[T,I]=(0,i.useState)(!1),[L,P]=(0,i.useState)(null),[H,V]=(0,i.useState)(null),U=(0,o.mN)({resolver:(0,d.u)(C),defaultValues:{type:"monthly",name:"",totalPrice:0,sumupLink:"",purchaseStartDate:"",purchaseEndDate:"",validityStartDate:"",validityEndDate:"",expiryWarningDate:""}}),q=U.watch("type");(0,i.useEffect)(()=>{if(T&&!L&&"seasonal"===q&&(null==H?void 0:H.startDate)&&(null==H?void 0:H.endDate)){var e,t;U.setValue("validityStartDate",A(null==(e=H.startDate)?void 0:e.toDate())||"",{shouldValidate:!0}),U.setValue("validityEndDate",A(null==(t=H.endDate)?void 0:t.toDate())||"",{shouldValidate:!0}),U.setValue("name","Abbonamento Stagionale")}else T&&!L&&"monthly"===q&&(U.setValue("name",""),U.setValue("validityStartDate",""),U.setValue("validityEndDate",""))},[q,H,U,L,T]);let B=async()=>{c(!0);try{let e=await (0,s.getDoc)((0,s.doc)(n.db,"settings","activity"));e.exists()?V(e.data()):t({variant:"destructive",title:"Impostazioni mancanti",description:"Le impostazioni di validit\xe0 della stagione (settings/activity) non sono state trovate."}),await R()}catch(e){console.error("Error fetching initial data: ",e),t({variant:"destructive",title:"Errore",description:"Impossibile caricare i dati."})}finally{c(!1)}},R=async()=>{try{let e=(0,s.query)((0,s.collection)(n.db,"subscriptions"),(0,s.orderBy)("validityStartDate","asc")),t=(await (0,s.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}));k(t)}catch(e){console.error("Error fetching subscriptions: ",e),t({variant:"destructive",title:"Errore",description:"Impossibile caricare gli abbonamenti."})}};(0,i.useEffect)(()=>{B()},[]);let W=async e=>{z(!0);let a={name:e.name,type:e.type,totalPrice:e.totalPrice,sumupLink:e.sumupLink||"",validityStartDate:s.Timestamp.fromDate((0,m.H)(e.validityStartDate)),validityEndDate:s.Timestamp.fromDate((0,m.H)(e.validityEndDate)),expiryWarningDate:s.Timestamp.fromDate((0,m.H)(e.expiryWarningDate)),purchaseStartDate:e.purchaseStartDate?s.Timestamp.fromDate((0,m.H)(e.purchaseStartDate)):null,purchaseEndDate:e.purchaseEndDate?s.Timestamp.fromDate((0,m.H)(e.purchaseEndDate)):null};try{if(L){let e=(0,s.doc)(n.db,"subscriptions",L.id);await (0,s.updateDoc)(e,a),t({title:"Abbonamento aggiornato!",variant:"success"})}else await (0,s.addDoc)((0,s.collection)(n.db,"subscriptions"),a),t({title:"Abbonamento creato!",variant:"success"});await R(),I(!1),P(null)}catch(e){console.error("Error saving subscription:",e),t({variant:"destructive",title:"Errore",description:"Impossibile salvare l'abbonamento."})}finally{z(!1)}},Y=async e=>{try{await (0,s.deleteDoc)((0,s.doc)(n.db,"subscriptions",e)),t({title:"Abbonamento eliminato",variant:"success"}),await R()}catch(e){console.error("Error deleting subscription:",e),t({variant:"destructive",title:"Errore",description:"Impossibile eliminare l'abbonamento."})}};return(0,r.jsxs)(p.Zp,{children:[(0,r.jsx)(p.aR,{children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(p.ZB,{children:"Gestione Abbonamenti"}),(0,r.jsx)(p.BT,{children:"Crea e gestisci i piani di abbonamento per gli utenti."})]}),(0,r.jsxs)(h.$,{onClick:()=>{P(null),U.reset({type:"monthly",name:"",totalPrice:0,sumupLink:"",purchaseStartDate:"",purchaseEndDate:"",validityStartDate:"",validityEndDate:"",expiryWarningDate:""}),I(!0)},children:[(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Aggiungi Abbonamento"]})]})}),(0,r.jsx)(p.Wu,{children:a?(0,r.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,r.jsx)(j.A,{className:"w-8 h-8 animate-spin"})}):(0,r.jsx)("div",{className:"rounded-md border",children:(0,r.jsxs)(S.XI,{children:[(0,r.jsx)(S.A0,{children:(0,r.jsxs)(S.Hj,{children:[(0,r.jsx)(S.nd,{children:"Nome"}),(0,r.jsx)(S.nd,{children:"Prezzo Totale"}),(0,r.jsx)(S.nd,{children:"Validit\xe0 Abbonamento"}),(0,r.jsx)(S.nd,{children:"Acquistabile Fino al"}),(0,r.jsx)(S.nd,{className:"text-right",children:"Azioni"})]})}),(0,r.jsx)(S.BF,{children:M.length>0?M.map(e=>(0,r.jsxs)(S.Hj,{children:[(0,r.jsx)(S.nA,{className:"font-medium",children:(0,r.jsx)(E.E,{variant:"monthly"===e.type?"secondary":"default",children:e.name})}),(0,r.jsxs)(S.nA,{children:[(e.totalPrice||0).toFixed(2)," €"]}),(0,r.jsx)(S.nA,{children:e.validityStartDate&&e.validityEndDate?"".concat((0,u.GP)(e.validityStartDate.toDate(),"dd/MM/yy")," - ").concat((0,u.GP)(e.validityEndDate.toDate(),"dd/MM/yy")):"Non definita"}),(0,r.jsx)(S.nA,{children:e.purchaseEndDate?(0,u.GP)(e.purchaseEndDate.toDate(),"dd/MM/yyyy"):"Sempre"}),(0,r.jsxs)(S.nA,{className:"text-right space-x-2",children:[(0,r.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>{P(e),U.reset({id:e.id,type:e.type,name:e.name,totalPrice:e.totalPrice,sumupLink:e.sumupLink,purchaseStartDate:A(e.purchaseStartDate)||"",purchaseEndDate:A(e.purchaseEndDate)||"",validityStartDate:A(e.validityStartDate)||"",validityEndDate:A(e.validityEndDate)||"",expiryWarningDate:A(e.expiryWarningDate)||""}),I(!0)},children:[(0,r.jsx)(v,{className:"h-4 w-4 mr-1"}),"Modifica"]}),(0,r.jsxs)(b.Lt,{children:[(0,r.jsx)(b.tv,{asChild:!0,children:(0,r.jsxs)(h.$,{variant:"destructive",size:"sm",children:[(0,r.jsx)(y.A,{className:"h-4 w-4 mr-1"}),"Elimina"]})}),(0,r.jsxs)(b.EO,{children:[(0,r.jsxs)(b.wd,{children:[(0,r.jsx)(b.r7,{children:"Sei sicuro?"}),(0,r.jsxs)(b.$v,{children:["Questa azione \xe8 irreversibile. L'abbonamento ",(0,r.jsx)("strong",{className:"mx-1",children:e.name})," sar\xe0 eliminato."]})]}),(0,r.jsxs)(b.ck,{children:[(0,r.jsx)(b.Zr,{children:"Annulla"}),(0,r.jsx)(b.Rx,{onClick:()=>Y(e.id),children:"S\xec, elimina"})]})]})]})]})]},e.id)):(0,r.jsx)(S.Hj,{children:(0,r.jsx)(S.nA,{colSpan:5,className:"text-center h-24 text-muted-foreground",children:"Nessun abbonamento trovato. Creane uno per iniziare."})})})]})})}),(0,r.jsx)(g.lG,{open:T,onOpenChange:I,children:(0,r.jsxs)(g.Cf,{className:"sm:max-w-2xl",children:[(0,r.jsx)(g.c7,{children:(0,r.jsx)(g.L3,{children:L?"Modifica Abbonamento":"Crea Nuovo Abbonamento"})}),(0,r.jsx)(f.lV,{...U,children:(0,r.jsxs)("form",{onSubmit:U.handleSubmit(W),className:"space-y-4 py-4",children:[(0,r.jsx)(f.zB,{control:U.control,name:"type",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Tipo"}),(0,r.jsxs)(N.l6,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,r.jsx)(f.MJ,{children:(0,r.jsx)(N.bq,{children:(0,r.jsx)(N.yv,{})})}),(0,r.jsxs)(N.gC,{children:[(0,r.jsx)(N.eb,{value:"monthly",children:"Mensile"}),(0,r.jsx)(N.eb,{value:"seasonal",children:"Stagionale"})]})]}),(0,r.jsx)(f.C5,{})]})}}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(f.zB,{control:U.control,name:"name",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Nome Abbonamento"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{placeholder:"Es. Abbonamento Ottobre",...t})}),(0,r.jsx)(f.C5,{})]})}}),(0,r.jsx)(f.zB,{control:U.control,name:"totalPrice",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Prezzo Totale (€)"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{type:"number",step:"0.01",...t})}),(0,r.jsx)(f.C5,{})]})}})]}),(0,r.jsxs)("div",{className:"space-y-2 rounded-md border p-4",children:[(0,r.jsx)("h4",{className:"text-sm font-medium",children:"Periodo di Validit\xe0"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[(0,r.jsx)(f.zB,{control:U.control,name:"validityStartDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Valido Dal"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{type:"date",...t})}),(0,r.jsx)(f.C5,{})]})}}),(0,r.jsx)(f.zB,{control:U.control,name:"validityEndDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Valido Fino Al"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{type:"date",...t})}),(0,r.jsx)(f.C5,{})]})}})]}),"seasonal"===q&&(null==H?void 0:H.startDate)&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground pt-2",children:["Le date per l'abbonamento stagionale vengono pre-compilate automaticamente ma possono essere modificate: ",(0,r.jsxs)("strong",{children:[(0,u.GP)(H.startDate.toDate(),"dd/MM/yy")," - ",(0,u.GP)((null==(e=H.endDate)?void 0:e.toDate())||new Date,"dd/MM/yy")]}),"."]})]}),(0,r.jsxs)("div",{className:"space-y-2 rounded-md border p-4",children:[(0,r.jsx)("h4",{className:"text-sm font-medium",children:"Impostazioni Avanzate"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[(0,r.jsx)(f.zB,{control:U.control,name:"expiryWarningDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Avviso Scadenza Dal"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{type:"date",...t})}),(0,r.jsx)(f.C5,{})]})}}),(0,r.jsx)(f.zB,{control:U.control,name:"sumupLink",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Link Pagamento SumUp (Opzionale)"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{...t,placeholder:"https://..."})}),(0,r.jsx)(f.C5,{})]})}})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[(0,r.jsx)(f.zB,{control:U.control,name:"purchaseStartDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Acquistabile Dal (Opzionale)"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{type:"date",...t})}),(0,r.jsx)(f.C5,{})]})}}),(0,r.jsx)(f.zB,{control:U.control,name:"purchaseEndDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(f.eI,{children:[(0,r.jsx)(f.lR,{children:"Acquistabile Fino Al (Opzionale)"}),(0,r.jsx)(f.MJ,{children:(0,r.jsx)(D.p,{type:"date",...t})}),(0,r.jsx)(f.C5,{})]})}})]})]}),(0,r.jsxs)(g.Es,{children:[(0,r.jsx)(h.$,{type:"button",variant:"ghost",onClick:()=>I(!1),children:"Annulla"}),(0,r.jsxs)(h.$,{type:"submit",disabled:w,children:[w&&(0,r.jsx)(j.A,{className:"animate-spin mr-2"}),"Salva"]})]})]})})]})})]})}},56898:(e,t,a)=>{Promise.resolve().then(a.bind(a,53756))}},e=>{e.O(0,[2992,7138,4909,3947,7134,9106,1930,2445,531,1821,3064,2885,2882,6980,8441,1255,7358],()=>e(e.s=56898)),_N_E=e.O()}]);