(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5345],{3134:(e,r,i)=>{"use strict";i.r(r),i.d(r,{default:()=>N});var l=i(95155),s=i(12115),a=i(14585),n=i(19708),t=i(15894),c=i(66942),o=i(22544),d=i(98734),u=i(86948),m=i(3998),h=i(22452),x=i(92033),j=i(13630),p=i(65142),v=i(51834),b=i(98053),g=i(41052),y=i(87270),f=i(11186);let w=d.Ik({name:d.Yj().min(1,"La selezione del tipo di premio \xe8 obbligatoria."),value:d.vk(e=>Number(String(e).replace(",",".")),d.ai().nonnegative("Il valore non pu\xf2 essere negativo."))});function N(){(0,s.useEffect)(()=>{R()},[]);let e=async()=>{if(L&&O)try{let{id:e,name:l,value:s}=L;await i.e(5217).then(i.bind(i,45217)).then(r=>r.createUserAward(O,e,l,s)),r({title:"Premio assegnato!"}),B(!1),V("")}catch(e){r({variant:"destructive",title:"Errore",description:"Impossibile assegnare il premio."})}},{toast:r}=(0,t.dj)(),[d,N]=(0,s.useState)(!0),[A,k]=(0,s.useState)([]),[C,P]=(0,s.useState)(!1),[z,S]=(0,s.useState)(!1),[E,$]=(0,s.useState)(null),[I,B]=(0,s.useState)(!1),[L,M]=(0,s.useState)(null),[O,V]=(0,s.useState)(""),[q,F]=(0,s.useState)([]);(0,s.useEffect)(()=>{(async()=>{try{let e=await (0,n.getDocs)((0,n.collection)(a.db,"users"));F(e.docs.map(e=>({id:e.id,name:e.data().name,surname:e.data().surname,gym:e.data().gym,discipline:e.data().discipline})))}catch(e){r({variant:"destructive",title:"Errore",description:"Impossibile caricare gli utenti."})}finally{N(!1)}})()},[r]);let D=(0,o.mN)({resolver:(0,c.u)(w),defaultValues:{name:"",value:0}}),R=async()=>{try{let e=(await (0,n.getDocs)((0,n.query)((0,n.collection)(a.db,"awards"),(0,n.orderBy)("name")))).docs.map(e=>({id:e.id,...e.data()}));k(e)}catch(e){console.error("Error fetching awards:",e),r({variant:"destructive",title:"Errore",description:"Impossibile caricare i premi."})}finally{N(!1)}},_=async e=>{P(!0);try{let i={name:e.name,value:e.value,residuo:e.value,used:!1,usedValue:0};if(E){let e=(0,n.doc)(a.db,"awards",E.id);await (0,n.updateDoc)(e,i),r({title:"Premio aggiornato!"})}else O?await (0,n.addDoc)((0,n.collection)(a.db,"users/".concat(O,"/awards")),i):await (0,n.addDoc)((0,n.collection)(a.db,"awards"),i),r({title:"Premio creato!"});await R(),S(!1)}catch(e){console.error("Error saving award:",e),r({variant:"destructive",title:"Errore",description:"Impossibile salvare il premio."})}finally{P(!1)}},H=async e=>{try{await (0,n.deleteDoc)((0,n.doc)(a.db,"awards",e)),r({title:"Premio eliminato"}),await R()}catch(e){console.error("Error deleting award:",e),r({variant:"destructive",title:"Errore",description:"Impossibile eliminare il premio."})}};return(0,l.jsxs)(u.Zp,{children:[(0,l.jsx)(u.aR,{children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(u.ZB,{children:"Gestione Premi"}),(0,l.jsx)(u.BT,{children:"Crea e gestisci i premi e i bonus che possono essere accumulati dagli atleti."})]}),(0,l.jsxs)(m.$,{onClick:()=>{$(null),D.reset({name:"",value:0}),S(!0)},children:[(0,l.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Crea Premio"]})]})}),(0,l.jsx)(u.Wu,{children:(0,l.jsx)("div",{className:"rounded-md border",children:(0,l.jsxs)(y.XI,{children:[(0,l.jsx)(y.A0,{children:(0,l.jsxs)(y.Hj,{children:[(0,l.jsx)(y.nd,{children:"Nome Premio"}),(0,l.jsx)(y.nd,{children:"Valore"}),(0,l.jsx)(y.nd,{className:"w-[180px] text-right",children:"Azioni"})]})}),(0,l.jsx)(y.BF,{children:d?(0,l.jsx)(y.Hj,{children:(0,l.jsx)(y.nA,{colSpan:3,className:"text-center h-24",children:(0,l.jsx)(x.A,{className:"mx-auto h-6 w-6 animate-spin"})})}):A.length>0?A.map(r=>(0,l.jsxs)(y.Hj,{children:[(0,l.jsx)(y.nA,{className:"font-medium",children:r.name}),(0,l.jsxs)(y.nA,{className:"font-bold",children:[r.value.toFixed(2)," €"]}),(0,l.jsxs)(y.nA,{className:"text-right space-x-1",children:[(0,l.jsx)(m.$,{variant:"secondary",size:"sm",onClick:()=>{M(r),B(!0)},children:"Assegna"}),(0,l.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>{$(r),D.reset({name:r.name,value:r.value}),S(!0)},children:"Modifica"}),(0,l.jsxs)(b.Lt,{children:[(0,l.jsx)(b.tv,{asChild:!0,children:(0,l.jsx)(m.$,{variant:"destructive",size:"sm",children:(0,l.jsx)(j.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(b.EO,{children:[(0,l.jsxs)(b.wd,{children:[(0,l.jsx)(b.r7,{children:"Sei sicuro?"}),(0,l.jsxs)(b.$v,{children:["Eliminare il premio ",(0,l.jsx)("strong",{className:"mx-1",children:r.name}),"? L'azione \xe8 irreversibile."]})]}),(0,l.jsxs)(b.ck,{children:[(0,l.jsx)(b.Zr,{children:"Annulla"}),(0,l.jsx)(b.Rx,{onClick:()=>H(r.id),children:"S\xec, elimina"})]})]})]})]}),(0,l.jsx)(v.lG,{open:I,onOpenChange:B,children:(0,l.jsxs)(v.Cf,{children:[(0,l.jsx)(v.c7,{children:(0,l.jsx)(v.L3,{children:"Assegna Premio"})}),(0,l.jsxs)("div",{className:"space-y-4 py-4",children:[(0,l.jsx)("label",{className:"block font-medium mb-2",children:"Seleziona utente"}),(0,l.jsxs)(f.l6,{onValueChange:V,value:O,children:[(0,l.jsx)(f.bq,{children:(0,l.jsx)(f.yv,{placeholder:"Seleziona utente..."})}),(0,l.jsx)(f.gC,{children:q.map(e=>(0,l.jsxs)(f.eb,{value:e.id,children:[e.surname?"".concat(e.surname," "):"",e.name,e.gym?" - ".concat(e.gym):"",e.discipline?" - ".concat(e.discipline):""]},e.id))})]})]}),(0,l.jsxs)(v.Es,{children:[(0,l.jsx)(m.$,{type:"button",variant:"ghost",onClick:()=>B(!1),children:"Annulla"}),(0,l.jsx)(m.$,{type:"button",onClick:e,disabled:!O,children:"Assegna"})]})]})})]},r.id)):(0,l.jsx)(y.Hj,{children:(0,l.jsx)(y.nA,{colSpan:3,className:"text-center h-24 text-muted-foreground",children:"Nessun premio trovato. Creane uno per iniziare."})})})]})})}),(0,l.jsx)(v.lG,{open:z,onOpenChange:S,children:(0,l.jsxs)(v.Cf,{children:[(0,l.jsx)(v.L3,{style:{position:"absolute",width:1,height:1,overflow:"hidden",clip:"rect(1px, 1px, 1px, 1px)"},children:E?"Modifica Premio":"Crea Nuovo Premio"}),(0,l.jsx)("div",{className:"flex flex-col space-y-1.5 text-center sm:text-left",children:(0,l.jsx)("h2",{className:"text-lg font-semibold leading-none tracking-tight",children:E?"Modifica Premio":"Crea Nuovo Premio"})}),(0,l.jsx)(g.lV,{...D,children:(0,l.jsxs)("form",{onSubmit:D.handleSubmit(_),className:"space-y-4 py-4",children:[(0,l.jsx)(g.zB,{control:D.control,name:"name",render:e=>{let{field:r}=e;return(0,l.jsxs)(g.eI,{children:[(0,l.jsx)(g.lR,{children:"Tipo di Premio"}),(0,l.jsxs)(f.l6,{onValueChange:r.onChange,defaultValue:r.value,children:[(0,l.jsx)(g.MJ,{children:(0,l.jsx)(f.bq,{children:(0,l.jsx)(f.yv,{placeholder:"Seleziona un tipo di premio..."})})}),(0,l.jsxs)(f.gC,{children:[(0,l.jsx)(f.eb,{value:"Bonus Inizio Percorso",children:"Bonus Inizio Percorso"}),(0,l.jsx)(f.eb,{value:"Premio Best Samurai",children:"Premio Best Samurai"}),(0,l.jsx)(f.eb,{value:"Premio Frequenza 1 lezione",children:"Premio Frequenza 1 lezione"}),(0,l.jsx)(f.eb,{value:"Premio Frequenza 2 lezioni",children:"Premio Frequenza 2 lezioni"}),(0,l.jsx)(f.eb,{value:"Premio Stage",children:"Premio Stage"}),(0,l.jsx)(f.eb,{value:"Altro premio",children:"Altro premio"})]})]}),(0,l.jsx)(g.C5,{})]})}}),(0,l.jsx)(g.zB,{control:D.control,name:"value",render:e=>{let{field:r}=e;return(0,l.jsxs)(g.eI,{children:[(0,l.jsx)(g.lR,{children:"Valore del Premio (€)"}),(0,l.jsx)(g.MJ,{children:(0,l.jsx)(p.p,{type:"number",step:"0.01",placeholder:"Es. 50.00",...r})}),(0,l.jsx)(g.C5,{})]})}}),(0,l.jsxs)(v.Es,{children:[(0,l.jsx)(m.$,{type:"button",variant:"ghost",onClick:()=>S(!1),children:"Annulla"}),(0,l.jsxs)(m.$,{type:"submit",disabled:C,children:[C?(0,l.jsx)(x.A,{className:"animate-spin mr-2"}):null,"Salva Premio"]})]})]})})]})})]})}},14294:(e,r,i)=>{"use strict";i.d(r,{A:()=>t});var l=i(12115);let s=function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return r.filter((e,r,i)=>!!e&&""!==e.trim()&&i.indexOf(e)===r).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,l.forwardRef)((e,r)=>{let{color:i="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:c,className:o="",children:d,iconNode:u,...m}=e;return(0,l.createElement)("svg",{ref:r,...a,width:n,height:n,stroke:i,strokeWidth:c?24*Number(t)/Number(n):t,className:s("lucide",o),...m},[...u.map(e=>{let[r,i]=e;return(0,l.createElement)(r,i)}),...Array.isArray(d)?d:[d]])}),t=(e,r)=>{let i=(0,l.forwardRef)((i,a)=>{let{className:t,...c}=i;return(0,l.createElement)(n,{ref:a,iconNode:r,className:s("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),t),...c})});return i.displayName="".concat(e),i}},22452:(e,r,i)=>{"use strict";i.d(r,{A:()=>l});let l=(0,i(14294).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},26615:(e,r,i)=>{"use strict";i.d(r,{A:()=>l});let l=(0,i(14294).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},83101:(e,r,i)=>{"use strict";i.d(r,{F:()=>n});var l=i(2821);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=l.$,n=(e,r)=>i=>{var l;if((null==r?void 0:r.variants)==null)return a(e,null==i?void 0:i.class,null==i?void 0:i.className);let{variants:n,defaultVariants:t}=r,c=Object.keys(n).map(e=>{let r=null==i?void 0:i[e],l=null==t?void 0:t[e];if(null===r)return null;let a=s(r)||s(l);return n[e][a]}),o=i&&Object.entries(i).reduce((e,r)=>{let[i,l]=r;return void 0===l||(e[i]=l),e},{});return a(e,c,null==r||null==(l=r.compoundVariants)?void 0:l.reduce((e,r)=>{let{class:i,className:l,...s}=r;return Object.entries(s).every(e=>{let[r,i]=e;return Array.isArray(i)?i.includes({...t,...o}[r]):({...t,...o})[r]===i})?[...e,i,l]:e},[]),null==i?void 0:i.class,null==i?void 0:i.className)}},92033:(e,r,i)=>{"use strict";i.d(r,{A:()=>l});let l=(0,i(14294).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},94114:(e,r,i)=>{Promise.resolve().then(i.bind(i,3134))}},e=>{e.O(0,[2992,7138,4909,3947,1930,2445,531,1821,3064,2885,2882,6980,8441,1255,7358],()=>e(e.s=94114)),_N_E=e.O()}]);